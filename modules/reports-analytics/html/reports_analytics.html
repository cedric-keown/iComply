<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reports & Analytics - iComply</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Phoenix Theme CSS -->
    <link href="https://prium.github.io/phoenix/v1.23.0/assets/css/phoenix.min.css" rel="stylesheet">
    <link href="https://prium.github.io/phoenix/v1.23.0/assets/css/theme.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Custom Styles -->
    <link href="../../../css/main.css" rel="stylesheet">
    <link href="../css/reports-analytics-styles.css" rel="stylesheet">
</head>
<body>
    <div class="reports-container">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="reportsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="library-tab" data-bs-toggle="tab" data-bs-target="#library" type="button" role="tab">
                    <i class="fas fa-book me-2"></i>Report Library
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="builder-tab" data-bs-toggle="tab" data-bs-target="#builder" type="button" role="tab">
                    <i class="fas fa-tools me-2"></i>Custom Report Builder
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="scheduled-tab" data-bs-toggle="tab" data-bs-target="#scheduled" type="button" role="tab">
                    <i class="fas fa-calendar-alt me-2"></i>Scheduled Reports
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                    <i class="fas fa-chart-line me-2"></i>Analytics Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="fsca-tab" data-bs-toggle="tab" data-bs-target="#fsca" type="button" role="tab">
                    <i class="fas fa-university me-2"></i>FSCA Reports
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                    <i class="fas fa-history me-2"></i>Export History
                </button>
            </li>
        </ul>

        <div class="tab-content" id="reportsTabContent">
            <!-- TAB 1: REPORT LIBRARY -->
            <div class="tab-pane fade show active" id="library" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2>Report Library</h2>
                        <p class="text-muted mb-0">Pre-built compliance reports ready to generate</p>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" id="createCustomReportBtn">
                            <i class="fas fa-plus me-1"></i> Create Custom Report
                        </button>
                        <button class="btn btn-outline-primary" id="scheduleNewReportBtn">
                            <i class="fas fa-calendar-plus me-1"></i> Schedule New Report
                        </button>
                    </div>
                </div>

                <!-- Report Categories -->
                <div id="reportCategories">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>

            <!-- TAB 2: CUSTOM REPORT BUILDER -->
            <div class="tab-pane fade" id="builder" role="tabpanel">
                <div class="mb-4">
                    <h2>Custom Report Builder</h2>
                    <p class="text-muted">Create tailored reports with drag-and-drop simplicity</p>
                </div>

                <!-- Step Indicator -->
                <div class="report-builder-steps mb-4">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Data Sources</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Fields</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Filters</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Display</div>
                    </div>
                    <div class="step" data-step="5">
                        <div class="step-number">5</div>
                        <div class="step-label">Format</div>
                    </div>
                    <div class="step" data-step="6">
                        <div class="step-number">6</div>
                        <div class="step-label">Save</div>
                    </div>
                </div>

                <!-- Step 1: Data Sources -->
                <div class="builder-step" id="step1">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Step 1: Select Data Sources</h5>
                        </div>
                        <div class="card-body">
                            <div id="dataSourcesList">
                                <!-- Populated by JavaScript -->
                            </div>
                            <div class="mt-3">
                                <strong>Selected: <span id="selectedSourcesCount">0</span> data sources</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Fields -->
                <div class="builder-step d-none" id="step2">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Available Fields</h5>
                                </div>
                                <div class="card-body">
                                    <div id="availableFieldsList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Selected Fields</h5>
                                </div>
                                <div class="card-body">
                                    <div id="selectedFieldsList">
                                        <p class="text-muted">Drag fields from left to add them to report</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Filters -->
                <div class="builder-step d-none" id="step3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Step 3: Apply Filters</h5>
                        </div>
                        <div class="card-body">
                            <div id="filtersConfiguration">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Display Options -->
                <div class="builder-step d-none" id="step4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Step 4: Configure Display Options</h5>
                        </div>
                        <div class="card-body">
                            <div id="displayOptions">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Output Format -->
                <div class="builder-step d-none" id="step5">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Step 5: Choose Output Format</h5>
                        </div>
                        <div class="card-body">
                            <div id="outputFormatOptions">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Save Template -->
                <div class="builder-step d-none" id="step6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Step 6: Save Report Template</h5>
                        </div>
                        <div class="card-body">
                            <div id="saveTemplateForm">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <button class="btn btn-secondary" id="prevStepBtn" style="display: none;">
                        <i class="fas fa-arrow-left me-1"></i> Previous
                    </button>
                    <div class="ms-auto">
                        <button class="btn btn-outline-secondary" id="previewReportBtn" style="display: none;">
                            <i class="fas fa-eye me-1"></i> Preview
                        </button>
                        <button class="btn btn-primary" id="nextStepBtn">
                        Next <i class="fas fa-arrow-right ms-1"></i>
                    </button>
                    </div>
                </div>
            </div>

            <!-- TAB 3: SCHEDULED REPORTS -->
            <div class="tab-pane fade" id="scheduled" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2>Scheduled Reports</h2>
                        <p class="text-muted mb-0">Automate report generation and delivery</p>
                    </div>
                    <button class="btn btn-primary" id="scheduleReportBtn">
                        <i class="fas fa-plus me-1"></i> Schedule New Report
                    </button>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Report Name</th>
                                        <th>Schedule</th>
                                        <th>Next Run</th>
                                        <th>Recipients</th>
                                        <th>Format</th>
                                        <th>Last Run</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduledReportsTable">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 4: ANALYTICS DASHBOARD -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <div class="mb-4">
                    <h2>Analytics Dashboard</h2>
                    <p class="text-muted">Real-time insights and data visualization</p>
                </div>

                <!-- KPI Cards -->
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-label">Total Reps</div>
                            <div class="kpi-value">36</div>
                            <div class="kpi-change text-muted">↔️ No change vs last month</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-label">Avg CPD Hours</div>
                            <div class="kpi-value">12.8</div>
                            <div class="kpi-change text-success">↑ +1.2 hours this month</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-label">FICA Verified</div>
                            <div class="kpi-value">93%</div>
                            <div class="kpi-change text-success">↑ +2% this quarter</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-label">Complaints</div>
                            <div class="kpi-value">14</div>
                            <div class="kpi-change text-success">↓ -3 cases vs last year</div>
                        </div>
                    </div>
                </div>

                <!-- Main Dashboard Grid -->
                <div class="row g-3 mb-4">
                    <!-- Quadrant 1: Compliance Health Score -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">FSP Compliance Health Score</h5>
                            </div>
                            <div class="card-body text-center">
                                <canvas id="complianceHealthGauge"></canvas>
                                <div class="mt-3" id="complianceComponents">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quadrant 2: Compliance Trends -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Compliance Trends (Last 6 Months)</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="complianceTrendsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <!-- Quadrant 3: Representative Distribution -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Representative Status Distribution</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="repDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Quadrant 4: Top Alerts -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Top 5 Priority Alerts</h5>
                            </div>
                            <div class="card-body">
                                <div id="topAlertsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Representative Performance Heatmap -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Representative Performance Heatmap</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm" id="performanceHeatmap">
                                <thead>
                                    <tr>
                                        <th>Rep Name</th>
                                        <th>CPD</th>
                                        <th>F&P</th>
                                        <th>FICA</th>
                                        <th>Docs</th>
                                        <th>Overall</th>
                                    </tr>
                                </thead>
                                <tbody id="heatmapTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 5: FSCA REPORTS -->
            <div class="tab-pane fade" id="fsca" role="tabpanel">
                <div class="mb-4">
                    <h2>FSCA Submission Reports</h2>
                    <p class="text-muted">Regulator-ready compliance reports</p>
                </div>

                <div id="fscaReportTemplates">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- TAB 6: EXPORT HISTORY -->
            <div class="tab-pane fade" id="history" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2>Export History</h2>
                        <p class="text-muted mb-0">Track all generated and exported reports</p>
                    </div>
                    <div class="d-flex gap-2">
                        <select class="form-select form-select-sm" id="historyFilter" style="width: auto;">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                </div>

                <!-- Export Statistics -->
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card info">
                            <div class="stat-label">Total Exports</div>
                            <div class="stat-number">847</div>
                            <small class="text-muted">↑ +23% vs last year</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card info">
                            <div class="stat-label">This Month</div>
                            <div class="stat-number">142</div>
                            <small class="text-muted">+15 reports vs Oct 2024</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card success">
                            <div class="stat-label">Success Rate</div>
                            <div class="stat-number">99.2%</div>
                            <small class="text-muted">842/847 successful</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card info">
                            <div class="stat-label">Total Size</div>
                            <div class="stat-number">8.4 GB</div>
                            <small class="text-muted">↑ +320 MB this month</small>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Report Name</th>
                                        <th>Generated</th>
                                        <th>Generated By</th>
                                        <th>Format</th>
                                        <th>Recipients</th>
                                        <th>File Size</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="exportHistoryTable">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Preview Modal -->
    <div class="modal fade" id="reportPreviewModal" tabindex="-1" aria-labelledby="reportPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportPreviewModalLabel">Report Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="reportPreviewContent">
                        <!-- Preview content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="generateReportBtn">
                        <i class="fas fa-download me-1"></i> Generate & Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Report Modal -->
    <div class="modal fade" id="scheduleReportModal" tabindex="-1" aria-labelledby="scheduleReportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleReportModalLabel">Schedule Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="scheduleReportForm">
                        <div class="mb-3">
                            <label class="form-label">Report Template</label>
                            <select class="form-select" id="scheduleReportTemplate" required>
                                <option value="">Select report...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Frequency</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="frequency" id="daily" value="daily">
                                <label class="btn btn-outline-primary" for="daily">Daily</label>
                                <input type="radio" class="btn-check" name="frequency" id="weekly" value="weekly" checked>
                                <label class="btn btn-outline-primary" for="weekly">Weekly</label>
                                <input type="radio" class="btn-check" name="frequency" id="monthly" value="monthly">
                                <label class="btn btn-outline-primary" for="monthly">Monthly</label>
                                <input type="radio" class="btn-check" name="frequency" id="quarterly" value="quarterly">
                                <label class="btn btn-outline-primary" for="quarterly">Quarterly</label>
                            </div>
                        </div>
                        <div class="mb-3" id="scheduleDayOptions" style="display: none;">
                            <label class="form-label">Day of Week</label>
                            <div class="d-flex gap-2">
                                <input type="checkbox" class="btn-check" id="mon" value="mon">
                                <label class="btn btn-outline-secondary" for="mon">Mon</label>
                                <input type="checkbox" class="btn-check" id="tue" value="tue" checked>
                                <label class="btn btn-outline-secondary" for="tue">Tue</label>
                                <input type="checkbox" class="btn-check" id="wed" value="wed">
                                <label class="btn btn-outline-secondary" for="wed">Wed</label>
                                <input type="checkbox" class="btn-check" id="thu" value="thu">
                                <label class="btn btn-outline-secondary" for="thu">Thu</label>
                                <input type="checkbox" class="btn-check" id="fri" value="fri">
                                <label class="btn btn-outline-secondary" for="fri">Fri</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Time</label>
                            <input type="time" class="form-control" id="scheduleTime" value="08:00" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Recipients</label>
                            <div id="scheduleRecipients">
                                <input type="email" class="form-control mb-2" placeholder="Email address">
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" id="addRecipientBtn">
                                <i class="fas fa-plus me-1"></i> Add Recipient
                            </button>
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Schedule</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <!-- Custom JS -->
    <script src="../js/reports-analytics.js"></script>
</body>
</html>

